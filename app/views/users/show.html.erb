<% content_for :css do %>
    <%= stylesheet_link_tag 'nav' %>
    <%= stylesheet_link_tag 'main_layouts' %>
<% end %>
<%= render "common/sidebar" %>
  <div class="app-content">
    <div class="projects-section">
        <div class="projects-section-header">
            <p>My Page</p>
            <p class="time "><%= Date.today %></p>
        </div>
        <!--ユーザー編集のAjax-->
        <div class="profile-header">
            <%= render partial: "users/profile", locals:{ user: @user } %>
        </div>
        <div class="projects-section-line">
            <div class="projects-status">
                <div class="item-status">
                    <span class="status-number"><%= @user.posts.count %></span>
                    <span class="status-type">Total Posts</span>
                </div>
                <div class="item-status">
                    <span class="status-number"><%= @user.follower.count %></span>
                    <span class="status-type">Followings</span>
                </div>
                <div class="item-status">
                    <span class="status-number"><%= @user.followed.count %></span>
                    <span class="status-type">Follower</span>
                </div>
            </div>
            <div class="view-actions">
                <% if @user.id == current_user.id %>
                    <%= link_to "Edit Profile", edit_user_path(@user), remote: true, class: "btn btn-primary w-10" %>
                    <div id="user-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"></div>
                <% end %>
                <% if current_user != @user %>
                    <% if current_user.following?(@user) %>
                      <%= link_to 'Unfollow', user_relationships_path(@user.id), method: :delete, remote: true, class: "btn btn-primary" %>
                    <% else %>
                      <%= link_to 'Follow', user_relationships_path(@user.id), method: :POST, remote: true, class: "btn btn-primary" %>
                    <% end %>
                <% end %>
                <button class="view-btn list-view " title="List View ">
                  <svg xmlns="http://www.w3.org/2000/svg " width="24 " height="24 " viewBox="0 0 24 24 " fill="none " stroke="currentColor " stroke-width="2 " stroke-linecap="round " stroke-linejoin="round " class="feather feather-list ">
                    <line x1="8 " y1="6 " x2="21 " y2="6 " />
                    <line x1="8 " y1="12 " x2="21 " y2="12 " />
                    <line x1="8 " y1="18 " x2="21 " y2="18 " />
                    <line x1="3 " y1="6 " x2="3.01 " y2="6 " />
                    <line x1="3 " y1="12 " x2="3.01 " y2="12 " />
                    <line x1="3 " y1="18 " x2="3.01 " y2="18 " />
                　</svg>
                </button>
                <button class="view-btn grid-view active " title="Grid View">
                  <svg xmlns="http://www.w3.org/2000/svg " width="20 " height="20 " viewBox="0 0 24 24 " fill="none " stroke="currentColor " stroke-width="2 " stroke-linecap="round " stroke-linejoin="round " class="feather feather-grid ">
                    <rect x="3 " y="3 " width="7 " height="7 " />
                    <rect x="14 " y="3 " width="7 " height="7 " />
                    <rect x="14 " y="14 " width="7 " height="7 " />
                    <rect x="3 " y="14 " width="7 " height="7 " />
                　</svg>
                </button>
            </div>
        </div>
        <div class="project-boxes jsGridView">
        <% @posts.each do |post| %>
            <div class="project-box-wrapper post-action-<%= post.id %>">
                <div class="project-box">
                    <div class="project-box-header">
                        <div class="project-box-header-introduction">
                            <%#= link_to attachment_image_tag(post.user, :profile_image, format: 'jpeg', size: "50x50", fallback: "no_image.jpg", size:'50x50'), user_path(post.user.id) %>
                            <%= link_to image_tag(@user.user_profile_or_empty, class:"border border-secondary rounded-circle border-0", size:"50x50"), user_path(post.user.id) %>
                            <%= link_to_if post.user, post.user.name, user_path(post.user.id) %>
                        </div>
                    <% if post.user_id == current_user.id %>
                    <div class="post-action-#{ post.id }">
                    <div data-toggle="modal" data-target="#editpost<%= post.id %>">
                        <!--<%#= link_to(content_tag(:i, nil, class: 'fas fa-edit'), edit_post_path(post), remote: true) %>-->
                        <i class="fas fa-edit"></i>
                    </div>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="editpost<%= post.id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Edit Post</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <%= form_with model: post, method: :patch, remote: true do |f| %>
                              <div class="modal-body">
                                <div class="form-group">
                                    <%= f.text_area :body %>
                                </div>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <%= f.submit "Update Post", class: "btn btn-primary" %>
                              </div>
                          <% end %>
                        </div>
                      </div>
                    </div>
                        <%= link_to(content_tag(:i, nil, class: 'fas fa-trash-alt'), post_path(post), method: :delete, remote: true, data: { confirm: '投稿を削除してよろしいでしょうか？' }) %>
                    </div>
                    <% end %>
                    </div>
                    <div class="project-box-content-header">
                        <p class="box-content-header "><%=safe_join(post.body.split("\n"),tag(:br))%></p>
                        <div data-toggle="modal" data-target="#postimage<%= post.image_id %>">
                      <%= attachment_image_tag(post, :image, format: 'jpeg', size: "80x80") %>
                    </div>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="postimage<%= post.image_id %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                        <div class="modal-content">
                          <div class="modal-header" style="height: 10px;">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            <%= attachment_image_tag(post, :image, format: 'jpeg', size: "450x450") %>
                          </div>
                        </div>
                      </div>
                    </div>
                    </div>
                    <div class="project-box-footer ">
                        <div class="participants ">
                            <div id="likes_buttons_<%= post.id %>">
                                <%= render partial: 'posts/post', locals: {post: post} %>
                            </div>
                        </div>
                        <div class="days-left">
                            <%= l post.created_at, format: :default %>
                        </div>
                    </div>
                </div>
            </div>
        <% end %>
        </div>
    </div>
      <!--フォロー、フォロワー欄（幅をコンパクトにしたい）-->
    <div class="messages-section ">
        <div class="follow-bar-right">
            <div class="projects-section-header ">
                <p>Following</p>
            </div>
            <% @following_users.each do |following_user| %>
            <div class="messages ">
                <div class="message-box">
                    <%= link_to (user_path(following_user.id)) do %>
                        <p><%#= attachment_image_tag(following_user, :profile_image, format: 'jpeg', size: "50x50", fallback: "no_image.jpg", size:'100x100') %></p>
                        <p><%= image_tag following_user.user_profile_or_empty, class:"border border-secondary rounded-circle border-0", size:"100x100" %></p>
                        <div class="message-content ">
                    <% end %>
                        <div class="message-header ">
                            <div class="name"><%= following_user.name %></div>
                        </div>
                    </div>
                </div>
            </div>
        <% end %>
        </div>
        <div class="follow-bar-left">
            <div class="projects-section-header ">
                <p>Follower</p>
            </div>
            <% @follower_users.each do |follower_user| %>
                <div class="messages ">
                    <div class="message-box ">
                        <%= link_to (user_path(follower_user.id)) do %>
                            <p><%= attachment_image_tag(follower_user, :profile_image, format: 'jpeg', size: "30x30", fallback: "no_image.jpg", size:'100x100') %></p>
                        <% end %>
                        <div class="message-content ">
                            <div class="message-header ">
                                <div class="name"><%= follower_user.name %></div>
                            </div>
                        </div>
                    </div>
                </div>
            <% end %>
        </div>
    </div>
  </div>
<!--<script type="text/javascript" src="main_layouts.js"></script>-->